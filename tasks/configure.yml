---

- name: main cfg template
  template:
    src: "syslog-ng_{{ansible_os_family}}-{{ansible_distribution_major_version}}.conf.j2"
    dest: "/etc/syslog-ng/syslog-ng.conf"
    owner: root
    group: root
    mode: 0644
  when: sng_cfg_template is defined
  notify: svc restart syslog-ng

- name: templates conf.d files
  template:
    src: "syslog-ng-confd.j2"
    dest: "{{sng_conf_dir}}/{{item.dest}}"
    owner: "{{sng_owner | default('root')}}"
    group: "{{sng_group | default('root')}}"
    mode: "{{sng_mode | default('0644')}}"
  with_items: "{{sng_templates}}"
  notify: svc restart syslog-ng

- name: copy conf.d files
  copy:
    src={{item.src}}
    dest={{item.dest}}
    owner={{sng_owner | default('root')}}
    group={{sng_group | default('root')}}
    mode={{sng_mode | default('0644')}}
  with_items: "{{sng_copy_files}}"
  notify: svc restart syslog-ng

- name: certificate content
  copy:
    content: "{{item.content}}"
    dest: "/etc/pki/tls/{{item.type}}/{{item.filename}}"
    owner: "{{item.owner|default(sng_user)}}"
    group: "{{item.group|default(sng_group)}}"
    mode: "{{item.mode|default(sng_cert_mode)}}"
  with_items: "{{sng_certs}}"
  when: item.type is defined and item.filename is defined and item.content is defined and item.src is not defined
  notify: svc restart syslog-ng

- name: certificate file
  copy:
    src: "{{item.file}}"
    dest: "/etc/pki/tls/{{item.type}}/{{item.filename}}"
    owner: "{{item.owner|default(sng_user)}}"
    group: "{{item.group|default(sng_group)}}"
    mode: "{{item.mode|default(sng_cert_mode)}}"
  with_items: "{{sng_certs}}"
  when: item.type is defined and item.filename is defined and item.file is defined and item.content is not defined
  notify: svc restart syslog-ng

- name: service enable, start
  service:
    name: "{{sng_svc_name}}"
    state: "{{sng_svc_state}}"
    enabled: "{{sng_svc_enabled}}"

